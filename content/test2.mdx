---
title: Gitでコミットに著名してみる
description: GitHubでコミットにverifiedとついてたらかっこいいですよね。
date: 2024-02-11
tags: ["Git", "GitHub", "security"]
---

ここではぱっと手順を書いていきます。

## gpg のインストール

各パッケージマネージャーでインストールしてください。

- mac

```bash
brew install gpg
# or
# brew install gpg2
```

Linux はもともと入ってると思いますが、なかったら

```bash
# arch
sudo pacman -S gnupg
# debian
sudo apt install gnupg
# rhel9
sudo dnf install gnupg
# rhel~8
sudo yum install gnupg
```

みたいな感じでインストールしちゃってください。gnupg2 でも大丈夫です。
(というか、2 のほうが良さそう。でも今回はどっちでも行けます。)
もし gnupg2 を使う場合はここから下のコマンドの`gpg`を`gpg2`に読み替えてください。
`gpg`でも`gpg2`にパスが通ってる場合もあると思います。その場合は大丈夫です。

### key の作成

まず、リストを見てみてください。

```bash
gpg --list-keys
```

これまでに作ってこなかったら何も出ないと思います。

Mac だと、信用データベースができました。みたくでるかもです。

このコマンドで作成できます。

```bash
gpg --gen-key
```

名前とメアドは gitconfig と同じにしてください。名前は GitHub と同じでやってるけど、違くてもできるかは不明。

次に鍵を取得をします。どこが鍵かめっちゃわかりづらいので、このコマンドで見れます。

```bash
gpg --list-keys --keyid-format LONG | grep pub | awk '{print $2}' | cut -d'/' -f2;
```

鍵がわかったらコピーしておいてください。ここからこの鍵を`<key>`と書きます。

作成した鍵には有効期限が設定されてます。(作成画面で出てると思います。)

変更したい場合は以下の通り。

```bash
gpg --expert --edit-key <key>

gpg> expire
# 0で無制限、他も書いてある通りにできます。
gpg> save
```

## gitconfig の設定

```bash
git config --global user.signingkey <key>
git config --global gpg.program gpg
```

このままだと、コミットするときに毎回`-S`オプションが必要になります。
面倒な方は以下で毎回勝手に著名してくれます。

```bash
git config --global commit.gpgsign true
```

## path 設定

bash の方は`.bashrc`に、zsh の方は`.zshrc`に以下を追加してください。

```bash
export GPG_TTY=$(tty)
```

## GitHub の設定

公開鍵を GitHub に登録する必要があります。

まずは公開鍵を出力します。

```bash
gpg --armor --export <key>
```

コピーしたら GitHub の Setting→SSH and GPG keys の下のほうの New GPG key で登録してください。

これでコミットしたら著名できてると思います。

## Mac 限定オプション

Mac はパスフレーズの入力画面を TUI ではなく、別ウィンドウで出来ます。

以下を行う。

```bash
brew install pinentry-mac
echo "pinentry-program /opt/homebrew/bin/pinentry-mac" > ~/.gnupg/gpg-agent.conf
gpgconf --kill gpg-agent
```

パスの部分は各々変える。

```bash
which pinentry-mac
```

これで確認できる。

以上、これでコミットに著名が付きましたとさ。
